<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ö–∞—Ä—Ç–∞ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
body {
    margin:0; padding:0;
    font-family:'Arial',sans-serif;
    background:linear-gradient(180deg,#0a1f3f,#1e3d7b,#4fa3ff);
    color:white; text-align:center;
}
header { padding:2rem 0; font-size:2rem; font-weight:bold; }
#map { width:100%; height:80vh; max-width:900px; margin:20px auto; border-radius:16px; box-shadow:0 0 20px rgba(0,0,0,0.4);}
.back-btn { display:inline-block; margin:10px 0; padding:10px 20px; background:rgba(255,255,255,0.15); border:2px solid rgba(255,255,255,0.3); border-radius:12px; color:white; text-decoration:none; transition:0.3s; }
.back-btn:hover { background:rgba(255,255,255,0.25); }

.modal {
    display:none; position:fixed; z-index:1000;
    left:0; top:0; width:100vw; height:100vh;
    background:rgba(0,0,0,0.95); justify-content:center; align-items:center;
}
.modal-content { max-width:90%; max-height:90%; display:flex; justify-content:center; align-items:center; position:relative; }
.modal-content img, .modal-content video { max-width:100%; max-height:100%; object-fit:contain; cursor:pointer; border-radius:12px; }
.modal-close { position:absolute; top:15px; right:15px; font-size:2rem; color:white; cursor:pointer; z-index:10; }
</style>
</head>
<body>

<header>–ö–∞—Ä—Ç–∞ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π üíô</header>
<a href="index.html" class="back-btn">‚Üê –ì–ª–∞–≤–Ω–∞—è</a>
<div id="map"></div>

<div class="modal" id="modal">
    <span class="modal-close" id="modalClose">&times;</span>
    <div class="modal-content" id="modalContent"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const map = L.map('map').setView([52.4064,16.9252],6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
    attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');
const modalClose = document.getElementById('modalClose');

let mediaItems = [];

// –ó–∞–≥—Ä—É–∂–∞–µ–º JSON —Å –º–µ–¥–∏–∞
fetch('data/media.json')
  .then(r=>r.json())
  .then(items=>{
    mediaItems = items;

    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º
    const grouped = {};
    items.forEach(item=>{
      if(!item.coords) return; // –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –º–µ–¥–∏–∞ –±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
      const key = item.coords.join(',');
      if(!grouped[key]) grouped[key]=[];
      grouped[key].push(item);
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –Ω–∞ –∫–∞—Ä—Ç—É
    Object.keys(grouped).forEach(key=>{
      const coords = key.split(',').map(Number);
      const photos = grouped[key];
      L.marker(coords).addTo(map).on('click', ()=>openModalGallery(photos));
    });
  });

// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ –¥–ª—è –≥—Ä—É–ø–ø—ã —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ
function openModalGallery(photos){
  modal.style.display='flex';
  modalContent.innerHTML='';
  let current = 0;

  function showPhoto(index){
    modalContent.innerHTML='';
    const p = photos[index];
    if(p.type==='image'){
      const img = document.createElement('img');
      img.src=p.src;
      modalContent.appendChild(img);
    } else if(p.type==='video'){
      const vid = document.createElement('video');
      vid.src=p.src;
      vid.controls=true;
      vid.autoplay=true;
      vid.playsInline=true;
      modalContent.appendChild(vid);
    }
  }

  showPhoto(current);

  // –õ–∏—Å—Ç–∞–µ–º –∞–ª—å–±–æ–º –∫–ª–∏–∫–æ–º
  modalContent.onclick = ()=>{
    current = (current+1)%photos.length;
    showPhoto(current);
  }
}

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏
modalClose.onclick = ()=>{
  modal.style.display='none';
  modalContent.innerHTML='';
};
modal.onclick = e=>{ if(e.target===modal) modalClose.onclick(); }
</script>

</body>
</html>
