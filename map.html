<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ö–∞—Ä—Ç–∞ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π</title>
<style>
body, html {margin:0; padding:0; width:100%; height:100%; font-family:'Arial', sans-serif; background:linear-gradient(180deg,#0a1f3f,#1e3d7b,#4fa3ff); color:white;}
header {padding:20px; text-align:center; font-size:2rem; font-weight:bold;}
#map {width:100%; height:80vh;}
.modal {display:none; position:fixed; z-index:1000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.95); justify-content:center; align-items:center; flex-direction:column;}
.modal-content {max-width:90%; max-height:80%; display:flex; justify-content:center; align-items:center; position:relative; transition: transform 0.4s ease;}
.modal-content img {max-width:100%; max-height:100%; object-fit:contain; cursor:pointer; border-radius:12px;}
.modal-close {position:absolute; top:15px; right:15px; font-size:2rem; color:white; cursor:pointer; z-index:10;}
.nav-btn {position:absolute; top:50%; transform:translateY(-50%); font-size:2.5rem; color:white; background:rgba(0,0,0,0.2); border:none; padding:8px 12px; cursor:pointer; border-radius:8px; z-index:10;}
#prevBtn {left:5px;}
#nextBtn {right:5px;}
.counter {margin-top:10px; font-size:1rem; opacity:0.8;}
.back-btn {display:inline-block; margin:10px; padding:8px 14px; background:rgba(255,255,255,0.15); border:2px solid rgba(255,255,255,0.3); border-radius:12px; color:white; text-decoration:none; transition:0.3s;}
.back-btn:hover {background:rgba(255,255,255,0.25);}
</style>
</head>
<body>

<header>–ö–∞—Ä—Ç–∞ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–π üíô</header>
<a href="index.html" class="back-btn">‚Üê –ì–ª–∞–≤–Ω–∞—è</a>
<div id="map"></div>

<div class="modal" id="modal">
    <span class="modal-close" id="modalClose">&times;</span>
    <button class="nav-btn" id="prevBtn">&#10094;</button>
    <div class="modal-content" id="modalContent"></div>
    <button class="nav-btn" id="nextBtn">&#10095;</button>
    <div class="counter" id="counter"></div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY"></script>
<script>
let map;
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');
const modalClose = document.getElementById('modalClose');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const counter = document.getElementById('counter');

let currentAlbum = [];
let currentIndex = 0;

// –ó–∞–≥—Ä—É–∂–∞–µ–º JSON
fetch('data/media.json')
  .then(r=>r.json())
  .then(items=>{
    const photos = items.filter(i=>i.type==='image' && i.lat && i.lng);

    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ñ–æ—Ç–æ –ø–æ –±–ª–∏–∑–æ—Å—Ç–∏ (10–º)
    const clusters = [];
    photos.forEach(photo=>{
      let added = false;
      for(const cluster of clusters){
        const dx = (cluster[0].lat - photo.lat)*111000;
        const dy = (cluster[0].lng - photo.lng)*111000*Math.cos(photo.lat*Math.PI/180);
        if(Math.sqrt(dx*dx + dy*dy) < 20){ // –≤ —Ä–∞–¥–∏—É—Å–µ 20 –º
          cluster.push(photo);
          added = true;
          break;
        }
      }
      if(!added) clusters.push([photo]);
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
    map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 52.388, lng: 16.944},
      zoom: 5
    });

    clusters.forEach(cluster=>{
      const marker = new google.maps.Marker({
        position: {lat: cluster[0].lat, lng: cluster[0].lng},
        map: map
      });
      marker.addListener('click', ()=>{
        openModal(cluster);
      });
    });
  });

// === –ú–æ–¥–∞–ª–∫–∞ ===
function openModal(album){
  currentAlbum = album;
  currentIndex = 0;
  modal.style.display='flex';
  showMedia(currentIndex);
}

function showMedia(index){
  modalContent.innerHTML = '';
  const item = currentAlbum[index];
  const img = document.createElement('img');
  img.src = item.src;
  modalContent.appendChild(img);
  counter.textContent = `${index+1} / ${currentAlbum.length}`;
}

// –ù–∞–≤–∏–≥–∞—Ü–∏—è —Å—Ç—Ä–µ–ª–∫–∞–º–∏
prevBtn.onclick = ()=>{ currentIndex = (currentIndex-1+currentAlbum.length)%currentAlbum.length; showMedia(currentIndex); }
nextBtn.onclick = ()=>{ currentIndex = (currentIndex+1)%currentAlbum.length; showMedia(currentIndex); }

// –ó–∞–∫—Ä—ã—Ç–∏–µ
modalClose.onclick = ()=>{ modal.style.display='none'; modalContent.innerHTML=''; }
modal.onclick = e=>{ if(e.target===modal) modalClose.onclick(); }
</script>

</body>
</html>
