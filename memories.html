<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Наши воспоминания</title>

<style>
body { margin:0; padding:0; font-family:'Arial', sans-serif; background:linear-gradient(180deg,#0a1f3f,#1e3d7b,#4fa3ff); color:white; text-align:center; overflow-x:hidden; position:relative; }
header { padding: 2rem 0; }
header h1 { font-size: 2.5rem; margin:0; letter-spacing:2px; }

.gallery { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:10px; max-width:1000px; margin:10px auto; padding:0 5px; }
.gallery-item { position:relative; background:rgba(255,255,255,0.15); border-radius:12px; overflow:hidden; cursor:pointer; opacity:0; transform:translateY(20px); transition:opacity 0.6s ease, transform 0.6s ease; }
.gallery-item.visible { opacity:1; transform:translateY(0); }
.gallery-item img, .gallery-item video { width:100%; height:100%; object-fit:cover; display:block; }

.like-btn, .comment-btn { position:absolute; bottom:6px; font-size:1.2rem; background:rgba(0,0,0,0.3); padding:3px 6px; border-radius:6px; color:white; cursor:pointer; user-select:none; }
.like-btn { left:6px; }
.comment-btn { right:6px; }

@keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.5); } 100% { transform: scale(1); } }
.pop { animation: pop 0.3s ease; }

.modal { 
    display:none; 
    position:fixed; 
    z-index:1000; 
    left:0; top:0; 
    width:100vw; height:100vh; 
    background:rgba(0,0,0,0.95); 
    justify-content:center; 
    align-items:center; 
    overflow:hidden; 
}
.modal-content { 
    max-width:90%;   /* Ограничение размера по ширине */
    max-height:80%;  /* Ограничение размера по высоте */
    width:auto; 
    height:auto; 
    display:flex; 
    justify-content:center; 
    align-items:center; 
    position:relative; 
    transition:transform 0.4s ease; 
}
.modal-content img, .modal-content video { 
    max-width:100%; 
    max-height:100%; 
    width:auto; 
    height:auto; 
    transform:scale(0); 
    transition: transform 0.5s ease; 
}

.nav-btn { position:absolute; top:50%; transform:translateY(-50%); font-size:2.5rem; color:white; background:rgba(0,0,0,0.2); border:none; padding:8px 12px; cursor:pointer; border-radius:8px; z-index:10; }
#prevBtn { left:5px; }
#nextBtn { right:5px; }

.modal-close { position:absolute; top:15px; right:15px; font-size:1.8rem; color:white; cursor:pointer; z-index:10; }

.back-btn { display:inline-block; margin:10px 0; padding:8px 14px; background:rgba(255,255,255,0.15); border:2px solid rgba(255,255,255,0.3); border-radius:12px; color:white; text-decoration:none; font-size:14px; transition:0.3s; }
.back-btn:hover { background:rgba(255,255,255,0.25); }

.long-tap-heart {
    position: absolute;
    font-size: 24px;
    animation: fly 1.5s ease-out forwards;
    pointer-events: none;
}
</style>
</head>
<body>

<header><h1>Наши воспоминания</h1></header>
<a href="index.html" class="back-btn">← Главная</a>

<h2>Фото</h2>
<div class="gallery" id="photoGallery"></div>

<h2>Видео</h2>
<div class="gallery" id="videoGallery"></div>

<div class="modal" id="modal">
    <span class="modal-close" id="modalClose">&times;</span>
    <button class="nav-btn" id="prevBtn">&#10094;</button>
    <div class="modal-content" id="modalContent"></div>
    <button class="nav-btn" id="nextBtn">&#10095;</button>
</div>

<script>
let photoItems = [];
let videoItems = [];
let currentIndex = 0;
let currentType = 'photo';

const photoGallery = document.getElementById('photoGallery');
const videoGallery = document.getElementById('videoGallery');
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');

// Загрузка JSON
fetch('data/media.json')
.then(r=>r.json())
.then(items=>{
    items.forEach((item,i)=>{
        const wrapper = document.createElement('div');
        wrapper.className = 'gallery-item';
        let media = document.createElement(item.type==='image'?'img':'video');
        media.src = item.src;
        if(item.type==='video'){ media.poster=item.poster||''; media.muted=true; media.playsInline=true; media.preload='metadata'; }
        wrapper.appendChild(media);

        // Добавляем в соответствующий контейнер
        if(item.type==='image'){
            photoItems.push(item);
            photoGallery.appendChild(wrapper);
        } else {
            videoItems.push(item);
            videoGallery.appendChild(wrapper);
        }

        // Показываем с анимацией
        setTimeout(()=>wrapper.classList.add('visible'), i*50);

        // Клик открывает модалку
        wrapper.onclick = ()=>{
            currentType = item.type==='image'?'photo':'video';
            currentIndex = currentType==='photo'? photoItems.indexOf(item) : videoItems.indexOf(item);
            openModal();
        };
    });
});

// Модалка
function openModal(){
    modal.style.display='flex';
    showModal();
}
function showModal(){
    modalContent.innerHTML='';
    const item = currentType==='photo'? photoItems[currentIndex] : videoItems[currentIndex];
    let clone = document.createElement(item.type==='image'?'img':'video');
    clone.src = item.src;
    if(item.type==='video'){ 
        clone.poster=item.poster||''; 
        clone.controls=true; 
        clone.autoplay=true; 
        clone.muted=false; 
    }
    modalContent.appendChild(clone);
    requestAnimationFrame(()=>{ clone.style.transform='scale(1)'; });
}

// Навигация
function slide(direction){
    if(currentType==='photo'){
        currentIndex = (currentIndex+direction+photoItems.length) % photoItems.length;
    } else {
        currentIndex = (currentIndex+direction+videoItems.length) % videoItems.length;
    }
    showModal();
}
prevBtn.onclick=()=>slide(-1);
nextBtn.onclick=()=>slide(1);

// Закрытие
document.getElementById('modalClose').onclick=()=>{
    const v = modalContent.querySelector('video'); if(v) v.pause();
    modal.style.display='none'; modalContent.innerHTML='';
};
modal.onclick=e=>{if(e.target===modal) document.getElementById('modalClose').onclick();}

// Свайпы для мобильных
let startX=0;
modalContent.addEventListener('touchstart', e=>startX=e.touches[0].clientX);
modalContent.addEventListener('touchend', e=>{
    const endX = e.changedTouches[0].clientX;
    if(endX-startX>40) slide(-1);
    else if(startX-endX>40) slide(1);
});
</script>

</body>
</html>
