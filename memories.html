<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Наши воспоминания</title>

<style>
* { box-sizing: border-box; }

body {
    margin:0;
    padding:0;
    font-family: Arial, sans-serif;
    background:linear-gradient(180deg,#0a1f3f,#1e3d7b,#4fa3ff);
    color:white;
    text-align:center;
    overflow-x:hidden;
    min-height:100dvh;
    -webkit-overflow-scrolling: touch;
}

header { padding: 2rem 0; }
header h1 { font-size: 2.5rem; margin:0; letter-spacing:2px; }

.gallery {
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(120px,1fr));
    gap:10px;
    max-width:1000px;
    margin:10px auto;
    padding:0 5px;
}

.gallery-item {
    position:relative;
    background:rgba(255,255,255,0.15);
    border-radius:12px;
    overflow:hidden;
    cursor:pointer;
    opacity:0;
    transform:translateY(20px);
    transition:opacity 0.5s ease, transform 0.5s ease;
    will-change: transform, opacity;
}

.gallery-item.visible {
    opacity:1;
    transform:translateY(0);
}

.gallery-item img,
.gallery-item video {
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
}

.modal {
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.95);
    justify-content:center;
    align-items:center;
    z-index:1000;
}

.modal-content {
    max-width:90%;
    max-height:80%;
    display:flex;
    justify-content:center;
    align-items:center;
    position:relative;
}

.modal-content img,
.modal-content video {
    max-width:100%;
    max-height:100%;
    transform:scale(0.95);
    transition: transform 0.3s ease;
}

.nav-btn {
    position:absolute;
    top:50%;
    transform:translateY(-50%);
    font-size:2.2rem;
    color:white;
    background:rgba(0,0,0,0.25);
    border:none;
    padding:8px 12px;
    cursor:pointer;
    border-radius:8px;
    z-index:10;
}

#prevBtn { left:6px; }
#nextBtn { right:6px; }

.modal-close {
    position:absolute;
    top:14px;
    right:14px;
    font-size:1.8rem;
    cursor:pointer;
}

.back-btn {
    display:inline-block;
    margin:10px 0;
    padding:8px 14px;
    background:rgba(255,255,255,0.15);
    border:2px solid rgba(255,255,255,0.3);
    border-radius:12px;
    color:white;
    text-decoration:none;
}
</style>
</head>
<body>

<header><h1>Наши воспоминания</h1></header>
<a href="index.html" class="back-btn">← Главная</a>

<h2>Фото</h2>
<div class="gallery" id="photoGallery"></div>

<h2>Видео</h2>
<div class="gallery" id="videoGallery"></div>

<div class="modal" id="modal">
    <span class="modal-close" id="modalClose">&times;</span>
    <button class="nav-btn" id="prevBtn">&#10094;</button>
    <div class="modal-content" id="modalContent"></div>
    <button class="nav-btn" id="nextBtn">&#10095;</button>
</div>

<script>
let photoItems = [];
let videoItems = [];
let currentIndex = 0;
let currentType = 'photo';

const photoGallery = document.getElementById('photoGallery');
const videoGallery = document.getElementById('videoGallery');
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');

fetch('data/media.json')
.then(r => r.json())
.then(items => {
    items.forEach((item, i) => {
        const wrapper = document.createElement('div');
        wrapper.className = 'gallery-item';

        const media = document.createElement(item.type === 'image' ? 'img' : 'video');
        media.src = item.src;

        if(item.type === 'video'){
            media.muted = true;
            media.playsInline = true;
            media.setAttribute('webkit-playsinline','');
            media.preload = 'none';
        }

        wrapper.appendChild(media);

        if(item.type === 'image'){
            photoItems.push(item);
            photoGallery.appendChild(wrapper);
        } else {
            videoItems.push(item);
            videoGallery.appendChild(wrapper);
        }

        setTimeout(() => wrapper.classList.add('visible'), i * 40);

        wrapper.addEventListener('click', () => {
            currentType = item.type === 'image' ? 'photo' : 'video';
            currentIndex = currentType === 'photo'
                ? photoItems.indexOf(item)
                : videoItems.indexOf(item);
            openModal();
        });
    });
})
.catch(()=>console.warn('media.json не загрузился'));

function openModal(){
    if((currentType === 'photo' && !photoItems.length) ||
       (currentType === 'video' && !videoItems.length)) return;

    modal.style.display = 'flex';
    showModal();
}

function showModal(){
    modalContent.innerHTML = '';
    const item = currentType === 'photo'
        ? photoItems[currentIndex]
        : videoItems[currentIndex];

    const el = document.createElement(item.type === 'image' ? 'img' : 'video');
    el.src = item.src;

    if(item.type === 'video'){
        el.controls = true;
        el.playsInline = true;
        el.setAttribute('webkit-playsinline','');
    }

    modalContent.appendChild(el);
    requestAnimationFrame(()=> el.style.transform='scale(1)');
}

function slide(dir){
    const arr = currentType === 'photo' ? photoItems : videoItems;
    currentIndex = (currentIndex + dir + arr.length) % arr.length;
    showModal();
}

document.getElementById('prevBtn').addEventListener('click',()=>slide(-1));
document.getElementById('nextBtn').addEventListener('click',()=>slide(1));

document.getElementById('modalClose').addEventListener('click', closeModal);
modal.addEventListener('click', e => { if(e.target === modal) closeModal(); });

function closeModal(){
    const v = modalContent.querySelector('video');
    if(v) v.pause();
    modal.style.display='none';
    modalContent.innerHTML='';
}

// свайпы iOS
let startX = 0;
modalContent.addEventListener('touchstart', e => startX = e.touches[0].clientX, {passive:true});
modalContent.addEventListener('touchend', e => {
    const dx = e.changedTouches[0].clientX - startX;
    if(Math.abs(dx) > 40) slide(dx > 0 ? -1 : 1);
});
</script>

</body>
</html>
