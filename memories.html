<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ù–∞—à–∏ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
body { margin:0; padding:0; font-family:'Arial', sans-serif; background:linear-gradient(180deg,#0a1f3f,#1e3d7b,#4fa3ff); color:white; text-align:center; overflow-x:hidden; position:relative; }
header { padding: 2rem 0; }
header h1 { font-size: 2.5rem; margin:0; letter-spacing:2px; }

/* –ì–∞–ª–µ—Ä–µ—è */
.gallery { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:10px; max-width:1000px; margin:10px auto; padding:0 5px; }
.gallery-item { position:relative; background:rgba(255,255,255,0.15); border-radius:12px; overflow:hidden; cursor:pointer; opacity:0; transform:translateY(20px); transition:opacity 0.6s ease, transform 0.6s ease; }
.gallery-item.visible { opacity:1; transform:translateY(0); }
.gallery-item img, .gallery-item video { width:100%; height:100%; object-fit:cover; display:block; }

/* –í–∏–¥–µ–æ –∏–∫–æ–Ω–∫–∞ */
.gallery-item.video::after { content:''; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:50px; height:50px; border-radius:50%; background:rgba(255,255,255,0.3); display:flex; align-items:center; justify-content:center; box-shadow:0 0 10px rgba(0,0,0,0.4); }
.gallery-item.video::before { content:''; position:absolute; top:50%; left:50%; transform:translate(-40%,-50%); width:0; height:0; border-left:18px solid white; border-top:12px solid transparent; border-bottom:12px solid transparent; }

/* –õ–∞–π–∫–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ */
.like-btn, .comment-btn { position:absolute; bottom:6px; font-size:1.2rem; background:rgba(0,0,0,0.3); padding:3px 6px; border-radius:6px; color:white; cursor:pointer; user-select:none; }
.like-btn { left:6px; }
.comment-btn { right:6px; }

/* –ê–Ω–∏–º–∞—Ü–∏—è –ª–∞–π–∫–∞ */
@keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.5); } 100% { transform: scale(1); } }
.pop { animation: pop 0.3s ease; }

/* –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è */
@keyframes commentPop { 0% { opacity:0; transform: translateY(10px); } 50% { opacity:1; transform: translateY(-5px); } 100% { opacity:0; transform: translateY(-15px); } }
.comment-feedback { position:absolute; bottom:30px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.5); padding:4px 10px; border-radius:6px; font-size:14px; animation: commentPop 1s ease forwards; pointer-events:none; }

/* –ú–æ–¥–∞–ª–∫–∞ */
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.95); justify-content:center; align-items:center; overflow:hidden; }
.modal-content { max-width:100%; max-height:100%; width:100%; height:100%; display:flex; justify-content:center; align-items:center; position:relative; transition:transform 0.4s ease; }
.modal-content img, .modal-content video { max-width:100%; max-height:100%; width:auto; height:auto; transform:scale(0); transition: transform 0.5s ease; }

/* –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
.nav-btn { position:absolute; top:50%; transform:translateY(-50%); font-size:2.5rem; color:white; background:rgba(0,0,0,0.2); border:none; padding:8px 12px; cursor:pointer; border-radius:8px; z-index:10; }
#prevBtn { left:5px; }
#nextBtn { right:5px; }

/* –ó–∞–∫—Ä—ã—Ç–∏–µ */
.modal-close { position:absolute; top:15px; right:15px; font-size:1.8rem; color:white; cursor:pointer; z-index:10; }

/* –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ */
.back-btn { display:inline-block; margin:10px 0; padding:8px 14px; background:rgba(255,255,255,0.15); border:2px solid rgba(255,255,255,0.3); border-radius:12px; color:white; text-decoration:none; font-size:14px; transition:0.3s; }
.back-btn:hover { background:rgba(255,255,255,0.25); }

/* Leaflet –∫–∞—Ä—Ç–∞ */
#map { height:300px; max-width:1000px; margin:20px auto; border-radius:12px; }
</style>
</head>
<body>

<header><h1>–ù–∞—à–∏ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏—è</h1></header>
<a href="index.html" class="back-btn">‚Üê –ì–ª–∞–≤–Ω–∞—è</a>
<div class="gallery" id="gallery"></div>

<div class="modal" id="modal">
    <span class="modal-close" id="modalClose">&times;</span>
    <button class="nav-btn" id="prevBtn">&#10094;</button>
    <div class="modal-content" id="modalContent"></div>
    <button class="nav-btn" id="nextBtn">&#10095;</button>
</div>

<div id="map"></div>

<script>
const gallery = document.getElementById('gallery');
const modal = document.getElementById('modal');
const modalContent = document.getElementById('modalContent');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
let mediaItems=[], currentIndex=0;

let storedLikes = JSON.parse(localStorage.getItem('likes')||'{}');
let storedComments = JSON.parse(localStorage.getItem('comments')||'{}');

fetch('data/media.json')
  .then(r=>r.json())
  .then(items=>{
    mediaItems=items;
    items.forEach((item,i)=>{
      const wrapper=document.createElement('div');
      wrapper.className='gallery-item';
      if(item.type==='video') wrapper.classList.add('video');

      let media = item.type==='image'? document.createElement('img') : document.createElement('video');
      media.src=item.src;
      if(item.type==='video'){ media.poster=item.poster||''; media.muted=true; media.playsInline=true; media.preload='metadata'; }
      wrapper.appendChild(media);

      // –õ–∞–π–∫
      const likeBtn = document.createElement('div');
      likeBtn.className = 'like-btn';
      likeBtn.textContent = `‚ù§Ô∏è ${storedLikes[i]||0}`;
      likeBtn.onclick = e=>{
        e.stopPropagation();
        storedLikes[i] = (storedLikes[i]||0)+1;
        localStorage.setItem('likes', JSON.stringify(storedLikes));
        likeBtn.textContent = `‚ù§Ô∏è ${storedLikes[i]}`;
        likeBtn.classList.remove('pop'); void likeBtn.offsetWidth; likeBtn.classList.add('pop');
      };
      wrapper.appendChild(likeBtn);

      // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
      const commentBtn = document.createElement('div');
      commentBtn.className = 'comment-btn';
      commentBtn.textContent = 'üí¨';
      commentBtn.onclick = e=>{
        e.stopPropagation();
        const c = prompt('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:');
        if(c){
          storedComments[i] = storedComments[i]||[];
          storedComments[i].push(c);
          localStorage.setItem('comments', JSON.stringify(storedComments));
          const feedback = document.createElement('div');
          feedback.className = 'comment-feedback';
          feedback.textContent = '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–±–∞–≤–ª–µ–Ω!';
          wrapper.appendChild(feedback);
          setTimeout(()=>feedback.remove(),1000);
        } else if(storedComments[i]?.length){
          alert('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:\n'+storedComments[i].join('\n'));
        }
      };
      wrapper.appendChild(commentBtn);

      gallery.appendChild(wrapper);
      setTimeout(()=>wrapper.classList.add('visible'), i*80);
      wrapper.onclick=()=>openModal(i);
    });
  })
  .catch(e=>console.error(e));

function openModal(i){
  currentIndex=i;
  showModal();
  modal.style.display='flex';
}

function showModal(){
  modalContent.innerHTML='';
  const item = mediaItems[currentIndex];
  if(!item.src){
      const placeholder = document.createElement('div');
      placeholder.style.width='100%'; placeholder.style.height='100%';
      placeholder.style.display='flex'; placeholder.style.alignItems='center'; placeholder.style.justifyContent='center';
      placeholder.style.color='white'; placeholder.style.fontSize='20px';
      placeholder.textContent='–ù–µ—Ç —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ üíî';
      modalContent.appendChild(placeholder);
      return;
  }

  let clone;
  if(item.type==='image'){
      clone = document.createElement('img');
      clone.src = item.src;
  } else {
      clone = document.createElement('video');
      clone.src = item.src;
      clone.poster = item.poster || '';
      clone.controls = true;
      clone.autoplay = true;
      clone.muted = true;
      clone.playsInline = true;
      clone.preload = 'metadata';
      clone.oncanplay = ()=>clone.play();
  }

  modalContent.appendChild(clone);
  requestAnimationFrame(()=>{ clone.style.transform='scale(1)'; });
}

function slide(direction){
  currentIndex = (currentIndex + direction + mediaItems.length) % mediaItems.length;
  showModal();
}

prevBtn.onclick=()=>slide(-1);
nextBtn.onclick=()=>slide(1);

document.getElementById('modalClose').onclick=()=>{
  const v=modalContent.querySelector('video'); if(v) v.pause();
  modal.style.display='none'; modalContent.innerHTML='';
};

modal.onclick=e=>{if(e.target===modal) document.getElementById('modalClose').onclick();}

let startX=0;
modalContent.addEventListener('touchstart',e=>startX=e.touches[0].clientX);
modalContent.addEventListener('touchend',e=>{
  const endX=e.changedTouches[0].clientX;
  if(endX-startX>40) slide(-1);
  else if(startX-endX>40) slide(1);
});

// Leaflet –∫–∞—Ä—Ç–∞
const map = L.map('map').setView([52.388,16.944], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ attribution:'&copy; OpenStreetMap contributors' }).addTo(map);

const geoData = [
  {index:1, lat:52.388425, lng:16.944808},{index:2, lat:52.391342, lng:16.948103},{index:3, lat:52.272950, lng:8.059461},
  {index:5, lat:52.274611, lng:8.079486},{index:6, lat:52.274611, lng:8.079486},{index:7, lat:52.274267, lng:8.049586},
  {index:9, lat:50.940947, lng:6.957831},{index:10, lat:50.940967, lng:6.957828},{index:11, lat:52.273578, lng:8.050144},
  {index:15, lat:52.279000, lng:8.05},{index:16, lat:52.382872, lng:16.927542},{index:20, lat:52.279000, lng:8.05},
  {index:21, lat:52.382211, lng:16.956908},{index:22, lat:52.273578, lng:8.050144},{index:23, lat:52.271286, lng:8.046617},
  {index:24, lat:52.266603, lng:8.112850},{index:25, lat:52.308089, lng:7.991075},{index:26, lat:52.521422, lng:11.492242},
  {index:27, lat:52.388344, lng:16.945019},{index:28, lat:52.388344, lng:16.945019},{index:29, lat:52.388344, lng:16.945019},
  {index:30, lat:52.388344, lng:16.945019},{index:31, lat:52.274569, lng:8.079481},{index:32, lat:52.274569, lng:8.079481},
  {index:33, lat:52.274569, lng:8.079481},{index:34, lat:52.274569, lng:8.079481},
];

// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –±–ª–∏–∑–∫–∏—Ö —Ç–æ—á–µ–∫ (~20 –º)
const grouped = {};
geoData.forEach(p=>{
  const key = p.lat.toFixed(4)+'_'+p.lng.toFixed(4);
  if(!grouped[key]) grouped[key]=[];
  grouped[key].push(p.index);
});

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤
for(const key in grouped){
  const [lat,lng] = key.split('_').map(Number);
  const marker = L.marker([lat,lng]).addTo(map);
  marker.on('click', ()=>{
    const indexes = grouped[key];
    currentIndex = indexes[0];
    showModal();
    modal.style.display='flex';
  });
}
</script>

</body>
</html>angedTouches[0].clientX;
  if(endX-startX>40) slide(-1);
  else if(startX-endX>40) slide(1);
});

// Leaflet –∫–∞—Ä—Ç–∞
const map = L.map('map').setView([52.388,16.944], 6);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ attribution:'&copy; OpenStreetMap contributors' }).addTo(map);

// –ì–µ–æ–¥–∞–Ω–Ω—ã–µ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
const geoData = [
  {index:1, lat:52.388425, lng:16.944808},
  {index:2, lat:52.391342, lng:16.948103},
  {index:3, lat:52.272950, lng:8.059461},
  {index:5, lat:52.274611, lng:8.079486},
  {index:6, lat:52.274611, lng:8.079486},
  {index:7, lat:52.274267, lng:8.049586},
  {index:9, lat:50.940947, lng:6.957831},
  {index:10, lat:50.940967, lng:6.957828},
  {index:11, lat:52.273578, lng:8.050144},
  {index:15, lat:52.279000, lng:8.05},
  {index:16, lat:52.382872, lng:16.927542},
  {index:20, lat:52.279000, lng:8.05},
  {index:21, lat:52.382211, lng:16.956908},
  {index:22, lat:52.273578, lng:8.050144},
  {index:23, lat:52.271286, lng:8.046617},
  {index:24, lat:52.266603, lng:8.112850},
  {index:25, lat:52.308089, lng:7.991075},
  {index:26, lat:52.521422, lng:11.492242},
  {index:27, lat:52.388344, lng:16.945019},
  {index:28, lat:52.388344, lng:16.945019},
  {index:29, lat:52.388344, lng:16.945019},
  {index:30, lat:52.388344, lng:16.945019},
  {index:31, lat:52.274569, lng:8.079481},
  {index:32, lat:52.274569, lng:8.079481},
  {index:33, lat:52.274569, lng:8.079481},
  {index:34, lat:52.274569, lng:8.079481},
];

// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –±–ª–∏–∑–∫–∏—Ö —Ç–æ—á–µ–∫ (~20 –º)
const grouped = {};
geoData.forEach(p=>{
  const key = p.lat.toFixed(4)+'_'+p.lng.toFixed(4);
  if(!grouped[key]) grouped[key]=[];
  grouped[key].push(p.index);
});

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤
for(const key in grouped){
  const [lat,lng] = key.split('_').map(Number);
  const marker = L.marker([lat,lng]).addTo(map);
  marker.on('click', ()=>{
    const indexes = grouped[key];
    currentSwipeIndexes = indexes;
    swipePos = 0;
    openModal(indexes[0]);
  });
}
</script>

</body>
</html>lat:52.279000, lng:8.05},
  {index:21, lat:52.382211, lng:16.956908},
  {index:22, lat:52.273578, lng:8.050144},
  {index:23, lat:52.271286, lng:8.046617},
  {index:24, lat:52.266603, lng:8.112850},
  {index:25, lat:52.308089, lng:7.991075},
  {index:26, lat:52.521422, lng:11.492242},
  {index:27, lat:52.388344, lng:16.945019},
  {index:28, lat:52.388344, lng:16.945019},
  {index:29, lat:52.388344, lng:16.945019},
  {index:30, lat:52.388344, lng:16.945019},
  {index:31, lat:52.274569, lng:8.079481},
  {index:32, lat:52.274569, lng:8.079481},
  {index:33, lat:52.274569, lng:8.079481},
  {index:34, lat:52.274569, lng:8.079481},
];

// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –±–ª–∏–∑–∫–∏—Ö —Ç–æ—á–µ–∫ (~20 –º)
const grouped = {};
geoData.forEach(p=>{
  const key = p.lat.toFixed(4)+'_'+p.lng.toFixed(4);
  if(!grouped[key]) grouped[key]=[];
  grouped[key].push(p.index);
});

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤
for(const key in grouped){
  const [lat,lng] = key.split('_').map(Number);
  const marker = L.marker([lat,lng]).addTo(map);
  marker.on('click', ()=>{
    const indexes = grouped[key];
    openModal(indexes[0]);
    currentSwipeIndexes = indexes;
  });
}

let currentSwipeIndexes = [];
</script>

</body>
</html>
